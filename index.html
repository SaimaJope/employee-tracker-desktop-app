<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self' https://cdn.jsdelivr.net 'unsafe-inline'; font-src 'self'; img-src 'self' data:; connect-src 'self' https://varah-8asg.onrender.com;">
    <title>VAHAR - Employee Attendance</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
    <style>
        :root, [data-theme=dark] {
            --v-black: #11191f;
            --v-dark-grey: #2f3136;
            --v-grey: #36393f;
            --v-blurple: #00a8e8;
            --v-white: #FFFFFF;
            --v-light-grey: #B9BBBE;
            --pico-font-family: -apple-system, system-ui, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            --pico-background-color: var(--v-black);
            --pico-color: var(--v-light-grey);
            --pico-h1-color: var(--v-white);
            --pico-h2-color: var(--v-white);
            --pico-h3-color: var(--v-white);
            --pico-card-background-color: var(--v-dark-grey);
            --pico-card-border-color: var(--v-dark-grey);
            --pico-form-element-background-color: var(--v-grey);
            --pico-form-element-border-color: var(--v-black);
            --pico-primary: var(--v-blurple);
            --pico-primary-hover: #0095cc;
            --pico-primary-focus: var(--v-blurple);
            --pico-primary-inverse: var(--v-white);
            --pico-form-element-placeholder-color: #8e9297;
        }

        html, body {
            height: 100%;
        }

        .centered-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            padding: 1rem;
        }

        #login-view article {
            padding: 2rem;
        }

        #show-register-modal {
            display: block;
            margin-top: 1rem;
            color: var(--pico-secondary);
            font-size: 0.9em;
        }

        dialog > article {
            padding: 1.5rem;
            border-color: var(--v-dark-grey);
            width: 420px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

            .modal-header h2 {
                margin: 0;
                font-size: 1.5em;
            }

        .close-button {
            background: transparent;
            border: none;
            padding: 0;
            margin: 0;
            display: block;
            width: 24px;
            height: 24px;
            cursor: pointer;
            margin-left: 1rem;
        }

            .close-button:focus, .close-button:focus-visible {
                outline: none;
                box-shadow: none;
            }

            .close-button svg {
                stroke: var(--pico-color);
                transition: stroke 0.2s ease-in-out;
            }

            .close-button:hover svg {
                stroke: var(--v-white);
            }

        dialog footer {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        #splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--v-black);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease-out;
        }

        .hidden {
            opacity: 0;
            pointer-events: none;
        }

        #app-content {
            transition: opacity 0.5s ease-in;
        }

        #splash-logo {
            width: 150px;
            height: 150px;
            animation: fadeInPulse 1.5s ease-in-out;
        }

        @keyframes fadeInPulse {
            0% {
                opacity: 0;
                transform: scale(0.95);
            }

            50% {
                opacity: 1;
                transform: scale(1.05);
            }

            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        #main-app-view.container {
            margin-top: 2rem;
            margin-bottom: 2rem;
        }

        /* === THE UPDATED LOGO STYLE === */
        #nav-logo {
            height: 40px;
            width: auto;
            margin-right: 1.5rem; /* A little more space */
            vertical-align: middle; /* Better alignment with buttons */
        }
    </style>
</head>
<body>
    <div id="splash-screen">
        <img src="./images/vahar_logo.png" alt="VAHAR Logo" id="splash-logo">
    </div>
    <div id="app-content" class="hidden">
        <div id="login-view" class="centered-container">
            <article style="width: 400px; text-align: center;">
                <h1 style="margin-bottom: 0.25rem;">VAHAR Tracker</h1>
                <p style="color: var(--pico-color); margin-top: 0;">Please Log In</p>
                <form id="login-form">
                    <input type="email" id="login-email" name="email" placeholder="Email Address" required>
                    <input type="password" id="login-password" name="password" placeholder="Password" required>
                    <button type="submit" id="login-button">Login</button>
                </form>
                <small id="login-error-message" style="min-height: 1.2em; display: block;"></small>
                <a href="#" id="show-register-modal">Need an account? Register here.</a>
            </article>
        </div>

        <main id="main-app-view" class="container" style="display: none;">
            <nav>
                <ul>
                    <li>
                        <img src="./images/vahar_logo.png" alt="VAHAR Logo" id="nav-logo">
                    </li>
                </ul>
                <ul>
                    <li><a href="#" id="nav-logs" role="button">Attendance Log</a></li>
                    <li><a href="#" id="nav-manage" role="button">Manage Employees</a></li>
                    <li><a href="#" id="nav-kiosks" role="button">Kiosks</a></li>
                    <li><a href="#" id="logout-button">Logout</a></li>
                </ul>
            </nav>
            <section id="log-section">
                <h2>Live Attendance Log</h2>
                <table id="log-table" role="grid">
                    <thead>
                        <tr>
                            <th>Employee Name</th>
                            <th>Event</th>
                            <th>Time</th>
                            <th>Card ID</th>
                        </tr>
                    </thead>
                    <tbody id="log-table-body"></tbody>
                </table>
            </section>
            <section id="manage-section" style="display: none;">
                <h2>Manage Employees</h2>
                <article>
                    <header>Add New Employee</header>
                    <div id="manage-status-message" style="margin-bottom: 1rem;"></div>
                    <form id="add-employee-form">
                        <input type="text" id="new-employee-name" name="name" placeholder="Employee Name" required>
                        <input type="text" id="new-employee-card-id" name="nfc_card_id" placeholder="NFC Card ID" required>
                        <button type="submit">Add Employee</button>
                    </form>
                </article>
                <h3>Current Employees</h3>
                <table id="employee-table" role="grid">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>NFC Card ID</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="employee-table-body"></tbody>
                </table>
            </section>
            <section id="kiosk-section" style="display: none;">
                <h2>Manage Kios.</h2>
                <p>API keys for your Android kiosk app.</p>
                <table id="kiosk-table" role="grid">
                    <thead>
                        <tr>
                            <th>Kiosk Name</th>
                            <th>API Key</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="kiosk-table-body"></tbody>
                </table>
            </section>
        </main>

        <dialog id="register-modal">
            <article>
                <div class="modal-header">
                    <h2>Register New Company</h2>
                    <button id="close-register-modal" class="close-button" aria-label="Close" type="button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
                </div>
                <form id="register-form">
                    <label for="register-companyName">Company Name</label><input type="text" id="register-companyName" name="companyName" required>
                    <label for="register-email">Admin Email</label><input type="email" id="register-email" name="email" required>
                    <label for="register-password">Password</label><input type="password" id="register-password" name="password" required>
                    <button type="submit" id="register-button">Register</button>
                </form>
                <small id="register-error-message"></small><small id="register-success-message"></small>
            </article>
        </dialog>

        <dialog id="delete-confirm-modal">
            <article>
                <div class="modal-header">
                    <h2>Delete Employee</h2>
                    <button id="cancel-delete-btn-x" class="close-button" aria-label="Close" type="button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
                </div>
                <p>Are you sure you want to permanently delete this employee? This action cannot be undone.</p>
                <footer><button id="cancel-delete-btn" class="secondary">Cancel</button><button id="confirm-delete-btn" class="contrast">Confirm Delete</button></footer>
            </article>
        </dialog>

        <script src="preload.js"></script>
    </div>
</body>
</html>